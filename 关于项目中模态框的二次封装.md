# å…³äºant design proé¡¹ç›®ä¸­æ¨¡æ€æ¡†çš„äºŒæ¬¡å°è£…

## :question: é—®é¢˜

é¡¹ç›®ä¸­ä½¿ç”¨ant design ç»„ä»¶åº“çš„è¿‡ç¨‹ä¸­ï¼Œæ ¹æ®éœ€æ±‚éœ€è¦åœ¨åŒä¸€ä¸ªé¡µé¢æˆ–è€…ä¸åŒé¡µé¢æœ‰å¤šä¸ªå¼¹æ¡†ï¼Œå¼¹æ¡†çš„æ ·å¼å¯ä»¥ç”±é…ç½®å‚æ•°è‡ªå®šä¹‰ï¼Œå†…å®¹æ ¹æ®ä¸šåŠ¡éœ€è¦ä¼šæœ‰æ‰€ä¸åŒã€‚æŒ‰ç…§å®˜æ–¹çš„å†™æ³•ï¼Œæœ€ç®€å•ç›´æ¥çš„å°±æ˜¯ç›´æ¥åœ¨renderå‡½æ•°ä¸­å¼•å…¥`Modal`ç»„ä»¶ï¼Œéœ€è¦å‡ ä¸ªå¼¹æ¡†å°±å¼•å…¥å‡ ä¸ªç»„ä»¶ã€‚å¦‚ä¸‹ï¼š

```tsx
<Modal1>
{/* å†…å®¹ */}
</Modal1>
<Modal2 >
{/* å†…å®¹ */}
</Modal2>
<Modal3 >
{/* å†…å®¹ */}
</Modal3>
```

å¦‚æœä¸€ä¸ªé¡µé¢éœ€è¦äºŒåä¸ªå¼¹æ¡†å‘¢ï¼Ÿï¼ˆä¸å¤ªå¯èƒ½ï¼‰ :thinking:ä¸€èˆ¬ä¸šåŠ¡ä¸­ï¼Œå¼¹æ¡†çš„å†…å®¹æ˜¯ä¸€äº›è¡¨å•ï¼Œè€Œè¡¨å•çš„æäº¤è¯·æ±‚æˆ–è€…ä¸€äº›å…¶ä»–çš„å¼‚æ­¥æ“ä½œéƒ½æ˜¯éœ€è¦åœ¨å¼¹æ¡†ç¡®è®¤åè§¦å‘çš„ï¼Œå¦‚æœå°†è®¸å¤šçš„`Modal`å…¨æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œé‚£ä¹ˆæ¯ä¸ª`Modal`çš„å†…éƒ¨é€»è¾‘å°±å…¨éƒ¨å †åœ¨ä¸€å—ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¥½çš„ã€‚æˆ‘ä»¬å¸Œæœ›ï¼Œçˆ¶ç»„ä»¶è°ƒç”¨`Modal`ç»„ä»¶åªå…³æ³¨å®ƒçš„æ˜¾ç¤ºï¼Œå…¶å†…éƒ¨çš„é€»è¾‘åº”è¯¥ç”±å†…éƒ¨å…³æ³¨å’Œå¤„ç†ã€‚

## :eyes:æˆ‘çš„è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ:one:

å°†æ¯ä¸ª`Modal`å•ç‹¬æŠ½ç¦»æˆä¸€ä¸ªReactå‡½æ•°ç»„ä»¶ï¼Œå†…éƒ¨è®¾ç½®å˜é‡`visible`æ¥æ§åˆ¶`Modal`çš„æ˜¾ç¤ºå’Œå…³é—­ï¼Œå¹¶ä¸”å†…éƒ¨æ‰€éœ€è¦çš„æ•°æ®ç”±`props`æä¾›ï¼Œçˆ¶ç»„ä»¶ç›¸åº”åœ°ä¹Ÿè®¾ç½®ä¸€ä¸ªå˜é‡`visible`å’Œä¸€ä¸ªæ”¹å˜`visible`çš„å‡½æ•°å¹¶å°†è¯¥å˜é‡å’Œå‡½æ•°é€šè¿‡`props`è½¬å…¥ã€‚

```tsx
//father.tsx
const [visible,setVisible] = useState<boolean>(false);
const handleVisible = (visible: boolean) => {
    setVisible(visible);
}

//renderå‡½æ•°
reutrn (
	...
    <childModal  {...props}/>
    ...
)
```

```tsx
//childModal.tsx
const childModal: React.FC<Props> = ({visible, ...props}) => {
   const [visible,setVisible] = useState<boolean>(false);
   useEffect(() => {
      setVisible(visible) ;
   },[visible])
    //å†…éƒ¨é€»è¾‘
    return (
        <Modal visible={visible} {...props}>
        <div>....</div>
        </Modal>
    )
}
export default memo(childModal)
```

è¿™ä¸ªæ–¹æ¡ˆçš„é—®é¢˜æ˜¯ï¼Œè™½ç„¶ç»„ä»¶å†…éƒ¨çš„é€»è¾‘èƒ½å¤ŸæŠ½ç¦»å‡ºæ¥ï¼Œä½†æ˜¯åœ¨çˆ¶ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™ä¾æ—§ä¼šå°†æ‰€æœ‰çš„`Modal`ä¸€èµ·æ¸²æŸ“ï¼Œè¿™å¸¦æ¥çš„é—®é¢˜å°±æ˜¯ï¼Œå¦‚æœ`Modal`å†…éƒ¨æœ‰å¤šä¸ªè€—æ—¶çš„ç½‘ç»œè¯·æ±‚ä»¥åŠå°†è¿”å›çš„å¤§é‡çš„æ•°æ®æ¸²æŸ“å‡ºæ¥ï¼Œæ­¤æ—¶æ‰“å¼€`Modal`å°±ä¼šå‡ºç°æ˜æ˜¾çš„å¡é¡¿ã€‚å…¶æ¬¡ï¼Œä¸ºäº†æ€§èƒ½ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¸Œæœ›ç­‰ç”¨æˆ·æ‰“å¼€`Modal`åå†å‘èµ·ç½‘ç»œè¯·æ±‚ã€‚æ˜¾ç„¶ï¼Œè¿™ä¸ªæ–¹æ¡ˆä¹Ÿä¸æ˜¯å¾ˆå®Œç¾ã€‚:thinking:

### æ–¹æ¡ˆ:two:

æ—¢ç„¶æ˜¯ä½¿ç”¨Reactè¿›è¡Œå¼€å‘ï¼Œé‚£å½“ç„¶ä¸èƒ½å¿˜äº†hookè¿™ä¸€åˆ©å™¨ã€‚å®šä¹‰ä¸€ä¸ª`useModal`,å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯`Modal`çš„å†…å®¹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯`Modal`çš„é…ç½®å‚æ•°ã€‚è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸º`Modal`ï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¸º`Modal`çš„å¼€å¯å‡½æ•°ã€‚æœ¬è´¨ä¸Šï¼Œè¿™ä¸ªæ–¹æ¡ˆå’Œç¬¬ä¸€ä¸ªæ˜¯ä¸€æ ·çš„ï¼ŒåŒæ ·éœ€è¦å°†`useModal`è¿”å›çš„`Modal`æŒ‚è½½åˆ°çˆ¶ç»„ä»¶ï¼Œä¸åŒçš„æ˜¯åˆ©ç”¨hookå¤ç”¨äº†ç›¸åŒçš„UIå’Œé€»è¾‘ã€‚

```tsx
//useModal.tsx
import { LoadingOutlined } from '@ant-design/icons';
import { useMemoizedFn } from 'ahooks';
import type { ModalProps as AntdModalProps } from 'antd';
import { Modal, Spin } from 'antd';
import { useState } from 'react';
import styles from './index.less';
/**
 * ä¼ å…¥Modalå†…å®¹ï¼Œè¿”å›Modalå®ä¾‹å’ŒModalçš„å¼€å…³
 */
type BodyProps = React.ReactElement;
type OnOkType = () => void | Promise<void>;
interface ModalProps extends Omit<AntdModalProps, 'onOk' | 'onCancel'> {
  icon?: React.ReactNode;
  title?: string;
  width?: number;
  footer?: boolean;
  closable?: boolean;
  onOk?: OnOkType;
  onCancel?: () => void | Promise<void>;
  cancelText?: string;
  okText?: string;
}
const useModal = (
  bodyProps: BodyProps,
  modalProps: ModalProps,
): [modalInstance: JSX.Element, openModal: () => void] => {
  const [visible, setVisible] = useState<boolean>(false);
  const [spinning, setSpinning] = useState<boolean>(false);
  const content = bodyProps;
  const {
    onOk,
    onCancel,
    icon = null,
    title = 'æ ‡é¢˜',
    width = 650,
    footer = true,
    closable = false,
    cancelText = 'å–æ¶ˆ',
    okText = 'ç¡®è®¤',
    ...reset
  } = modalProps;
  const openModal = () => {
    setVisible(true);
  };
  //Modalå…³é—­
  const handleCancle = () => {
    if (onCancel) {
      onCancel();
    }
    setVisible(false);
  };
  //Modalå†…å®¹æäº¤
  const handleConfirm = useMemoizedFn(async () => {
    setSpinning(true);
    if (onOk) await onOk();
    setSpinning(false);
    setVisible(false);
  });
  //renderå‡½æ•°
  const modal = () => {
    return (
      <Modal
        {...reset}
        title={
          <div style={{ textAlign: 'center' }}>
            {icon}
            {title}
          </div>
        }
        closable={closable}
        onCancel={handleCancle}
        footer={
          footer ? (
            <div className={styles.modal_footer}>
              <button className={styles.btn_cancel} onClick={handleCancle}>
                {cancelText}
              </button>
              <button className={styles.btn_confirm} onClick={handleConfirm}>
                {okText}
              </button>
            </div>
          ) : null
        }
        width={width}
        destroyOnClose
        visible={visible}
      >
        <Spin indicator={<LoadingOutlined style={{ fontSize: 24 }} spin />} spinning={spinning}>
          {content}
        </Spin>
      </Modal>
    );
  };
  return [modal(), openModal];
};

export default useModal;

```

```tsx
//father.tsx
  //æ–°å»ºèœå•çš„Modal
  const [createModal, openCreateModal] = useModal(
    <CreateForm
      ref={createFormRef}
      {...props}
    />,
    {
      title: 'åˆ›å»ºxxx',
      onOk: () => {
        createFormRef.current?.confirm();
      },
    },
  );

reutrn {
    ...
    {createModal}
    ...
}
```

æ–¹æ¡ˆäºŒè™½ç„¶æ²¡æœ‰åœ¨çˆ¶ç»„ä»¶äº§ç”Ÿé‡å¤çš„`state`ï¼Œä½†æ˜¯éœ€è¦å¯¹æ¯ä¸ª`Modal`ä½¿ç”¨ç±»å‹ç›¸åŒçš„`ref`è·å–å†…éƒ¨çš„æ–¹æ³•æ¥è°ƒç”¨ã€‚:thinking:å¹¶æ²¡æœ‰è¾¾åˆ°æˆ‘ç†æƒ³ä¸­çš„æ•ˆæœã€‚

### æ–¹æ¡ˆ:three:

èƒ½ä¸èƒ½ä¸åœ¨çˆ¶ç»„ä»¶ä¸­ç›´æ¥æ¸²æŸ“ï¼Œç±»ä¼¼`Modal.confirm()`è¿™ç§ç›´æ¥ä½¿ç”¨å‡½æ•°çš„å½¢å¼æ¥è°ƒç”¨å‘¢ï¼Ÿç ”ç©¶äº†ä¸€ä¸‹`Modal.confirm()`çš„æºç ï¼Œå®ç°èµ·æ¥æŒºç®€å•çš„ã€‚åŸç†å°±æ˜¯åœ¨æ ¹èŠ‚ç‚¹ä¸‹åŠ¨æ€æŒ‚è½½æˆ‘ä»¬éœ€è¦çš„`Modal`èŠ‚ç‚¹ã€‚ç²˜ä¸Šä»£ç ï¼š

```tsx
import * as ReactDOM from 'react-dom'
function openModal(content, config) {
  const div = document.createElement('div')
  document.body.appendChild(div)

  let currentConfig = {
    ...config,
    visible: true,
    onCancel: () => {
      if (config.onCancel) {
        config.onCancel()
      }
      close()
    },
    onOk: () => {
      if (config.onOk) {
        config.onOk()
      }
      close()
    },
  }

  function render(props) {
    setTimeout(() => {
      ReactDOM.render(
          <MyModal {...props} >
          {content}
          </MyModal>
        div
      )
    })
  }

  function destroy() {
    const unmountResult = ReactDOM.unmountComponentAtNode(div)
    if (unmountResult && div.parentNode) {
      div.parentNode.removeChild(div)
    }
  }

  function close() {
    render({
      ...currentConfig,
      visible: false,
      afterClose: destroy,
    })
  }

  render(currentConfig)
}

export default openModal
```

ç›®å‰è¿™ä¸ªæ–¹æ¡ˆè¿˜æ˜¯ä¼šæœ‰ç‚¹é—®é¢˜ï¼Œä¾æ—§æ²¡æœ‰è¾¾åˆ°æˆ‘æƒ³è¦çš„æ•ˆæœã€‚ğŸ¤£è¿˜æ˜¯å…ˆé‡‡ç”¨æ–¹æ¡ˆäºŒï¼Œåç»­çœ‹èƒ½ä¸èƒ½æœ‰æ›´åŠ ä¼˜é›…æ–¹ä¾¿åœ°ä½¿ç”¨`Modal`çš„è§£å†³æ–¹æ¡ˆã€‚