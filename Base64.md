## Base64 编码原理

接下来我们通过将 `abcd` 4 个字符转为 Base64 编码，来了解下它的原理。

1. 把字符三三分组，不够时通过 0 补齐。比如 `abc`三个字符归一组，`d` 不够三位，通过 `0` 补齐为 `d00`

[![image.png](https://camo.githubusercontent.com/2ccdb6eeae4b842e2b8e75b56acb5af8cb8abdd319212fb066bdff1e6b466ecd/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323032322f706e672f3138393335302f313635343432303538323131352d61333438353531642d313339392d343035372d613630622d3763383165333935396538352e706e6723636c69656e7449643d7538313135653762332d323864392d342663726f703d302663726f703d302663726f703d312663726f703d312666726f6d3d7061737465266865696768743d34302669643d756663396362343134266d617267696e3d2535426f626a6563742532304f626a656374253544266e616d653d696d6167652e706e67266f726967696e4865696768743d3830266f726967696e57696474683d31353030266f726967696e616c547970653d62696e61727926726174696f3d3126726f746174696f6e3d302673686f775469746c653d66616c73652673697a653d3131323238267374617475733d646f6e65267374796c653d6e6f6e65267461736b49643d7538313137623238302d323664312d343861612d613137302d3562653333326230373732267469746c653d2677696474683d373530)](https://camo.githubusercontent.com/2ccdb6eeae4b842e2b8e75b56acb5af8cb8abdd319212fb066bdff1e6b466ecd/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323032322f706e672f3138393335302f313635343432303538323131352d61333438353531642d313339392d343035372d613630622d3763383165333935396538352e706e6723636c69656e7449643d7538313135653762332d323864392d342663726f703d302663726f703d302663726f703d312663726f703d312666726f6d3d7061737465266865696768743d34302669643d756663396362343134266d617267696e3d2535426f626a6563742532304f626a656374253544266e616d653d696d6167652e706e67266f726967696e4865696768743d3830266f726967696e57696474683d31353030266f726967696e616c547970653d62696e61727926726174696f3d3126726f746174696f6e3d302673686f775469746c653d66616c73652673697a653d3131323238267374617475733d646f6e65267374796c653d6e6f6e65267461736b49643d7538313137623238302d323664312d343861612d613137302d3562653333326230373732267469746c653d2677696474683d373530)

1. 把字符转换成二进制 ASCII 编码

[![image.png](https://camo.githubusercontent.com/85eadce70bd520caa531f82d0997bcce326b0b47add9b5b92459a86beb2ecec2/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323032322f706e672f3138393335302f313635343432303539333035362d35633939663831632d353136332d346639392d396537372d6537646336643639613636342e706e6723636c69656e7449643d7538313135653762332d323864392d342663726f703d302663726f703d302663726f703d312663726f703d312666726f6d3d7061737465266865696768743d3131322669643d753935636662643038266d617267696e3d2535426f626a6563742532304f626a656374253544266e616d653d696d6167652e706e67266f726967696e4865696768743d323234266f726967696e57696474683d31353030266f726967696e616c547970653d62696e61727926726174696f3d3126726f746174696f6e3d302673686f775469746c653d66616c73652673697a653d3332313135267374617475733d646f6e65267374796c653d6e6f6e65267461736b49643d7531303563313138342d633432392d343538372d393838302d6431643931323537636437267469746c653d2677696474683d373530)](https://camo.githubusercontent.com/85eadce70bd520caa531f82d0997bcce326b0b47add9b5b92459a86beb2ecec2/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323032322f706e672f3138393335302f313635343432303539333035362d35633939663831632d353136332d346639392d396537372d6537646336643639613636342e706e6723636c69656e7449643d7538313135653762332d323864392d342663726f703d302663726f703d302663726f703d312663726f703d312666726f6d3d7061737465266865696768743d3131322669643d753935636662643038266d617267696e3d2535426f626a6563742532304f626a656374253544266e616d653d696d6167652e706e67266f726967696e4865696768743d323234266f726967696e57696474683d31353030266f726967696e616c547970653d62696e61727926726174696f3d3126726f746174696f6e3d302673686f775469746c653d66616c73652673697a653d3332313135267374617475733d646f6e65267374796c653d6e6f6e65267461736b49643d7531303563313138342d633432392d343538372d393838302d6431643931323537636437267469746c653d2677696474683d373530)

1. 把转换后的二进制，每六位分隔开

[![image.png](https://camo.githubusercontent.com/58fb43d263a614ef2d48f0064485bb227c1d2170edd8cbdf20a2b6b238e9f760/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323032322f706e672f3138393335302f313635343432303630353136362d34386361663731322d313163382d346164302d396532362d3638613238316630306332362e706e6723636c69656e7449643d7538313135653762332d323864392d342663726f703d302663726f703d302663726f703d312663726f703d312666726f6d3d7061737465266865696768743d3134392669643d753865643532373564266d617267696e3d2535426f626a6563742532304f626a656374253544266e616d653d696d6167652e706e67266f726967696e4865696768743d323938266f726967696e57696474683d31343938266f726967696e616c547970653d62696e61727926726174696f3d3126726f746174696f6e3d302673686f775469746c653d66616c73652673697a653d3339343635267374617475733d646f6e65267374796c653d6e6f6e65267461736b49643d7533386164373833642d623965632d343963332d383665342d3832623435383731356130267469746c653d2677696474683d373439)](https://camo.githubusercontent.com/58fb43d263a614ef2d48f0064485bb227c1d2170edd8cbdf20a2b6b238e9f760/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323032322f706e672f3138393335302f313635343432303630353136362d34386361663731322d313163382d346164302d396532362d3638613238316630306332362e706e6723636c69656e7449643d7538313135653762332d323864392d342663726f703d302663726f703d302663726f703d312663726f703d312666726f6d3d7061737465266865696768743d3134392669643d753865643532373564266d617267696e3d2535426f626a6563742532304f626a656374253544266e616d653d696d6167652e706e67266f726967696e4865696768743d323938266f726967696e57696474683d31343938266f726967696e616c547970653d62696e61727926726174696f3d3126726f746174696f6e3d302673686f775469746c653d66616c73652673697a653d3339343635267374617475733d646f6e65267374796c653d6e6f6e65267461736b49643d7533386164373833642d623965632d343963332d383665342d3832623435383731356130267469746c653d2677696474683d373439)

> Q：为什么第一步需要分三个字符一组？
>
> A：因为 ASCII 码每个字符是 8 位二进制，3 * 8 = 24。正好可以被第三步拆分为 4 个 6 位二进制，4 * 6 = 24。

1. 6 位二进制能代表 `0-63`，我们有一个彩虹表，可以将 0-63 分别对应一个字符，彩虹表如下：

[![image.png](https://camo.githubusercontent.com/8b3047e9b765613ead392bdd14a9b2d90593bc810a161213c04d444b0fee52e4/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323032322f706e672f3138393335302f313635343432303536353534332d63313430373632372d633561642d343264662d383338372d3662313765313332306330362e706e6723636c69656e7449643d7538313135653762332d323864392d342663726f703d302663726f703d302663726f703d312663726f703d312666726f6d3d7061737465266865696768743d3537392669643d756132383532323631266d617267696e3d2535426f626a6563742532304f626a656374253544266e616d653d696d6167652e706e67266f726967696e4865696768743d31313538266f726967696e57696474683d31333434266f726967696e616c547970653d62696e61727926726174696f3d3126726f746174696f6e3d302673686f775469746c653d66616c73652673697a653d323537333333267374617475733d646f6e65267374796c653d6e6f6e65267461736b49643d7535383864353130612d663062302d346636382d613838372d6663633066643065616137267469746c653d2677696474683d363732)](https://camo.githubusercontent.com/8b3047e9b765613ead392bdd14a9b2d90593bc810a161213c04d444b0fee52e4/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323032322f706e672f3138393335302f313635343432303536353534332d63313430373632372d633561642d343264662d383338372d3662313765313332306330362e706e6723636c69656e7449643d7538313135653762332d323864392d342663726f703d302663726f703d302663726f703d312663726f703d312666726f6d3d7061737465266865696768743d3537392669643d756132383532323631266d617267696e3d2535426f626a6563742532304f626a656374253544266e616d653d696d6167652e706e67266f726967696e4865696768743d31313538266f726967696e57696474683d31333434266f726967696e616c547970653d62696e61727926726174696f3d3126726f746174696f6e3d302673686f775469746c653d66616c73652673697a653d323537333333267374617475733d646f6e65267374796c653d6e6f6e65267461736b49643d7535383864353130612d663062302d346636382d613838372d6663633066643065616137267469746c653d2677696474683d363732)

通过彩虹表，我们可以将每 6 位分割后的二进制做一次转换

[![image.png](https://camo.githubusercontent.com/dcf2d51f2821eef9fa03e8d0f105200b988791297781679e25dd2863b0c0f808/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323032322f706e672f3138393335302f313635343432303632373030392d63363239316439302d356162322d343331342d613264382d3430343963643332366634622e706e6723636c69656e7449643d7538313135653762332d323864392d342663726f703d302663726f703d302663726f703d312663726f703d312666726f6d3d7061737465266865696768743d3138342669643d756232663232346439266d617267696e3d2535426f626a6563742532304f626a656374253544266e616d653d696d6167652e706e67266f726967696e4865696768743d333638266f726967696e57696474683d31343936266f726967696e616c547970653d62696e61727926726174696f3d3126726f746174696f6e3d302673686f775469746c653d66616c73652673697a653d3438333136267374617475733d646f6e65267374796c653d6e6f6e65267461736b49643d7531373234333566332d323539372d346331302d383561372d3834363135663463656338267469746c653d2677696474683d373438)](https://camo.githubusercontent.com/dcf2d51f2821eef9fa03e8d0f105200b988791297781679e25dd2863b0c0f808/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323032322f706e672f3138393335302f313635343432303632373030392d63363239316439302d356162322d343331342d613264382d3430343963643332366634622e706e6723636c69656e7449643d7538313135653762332d323864392d342663726f703d302663726f703d302663726f703d312663726f703d312666726f6d3d7061737465266865696768743d3138342669643d756232663232346439266d617267696e3d2535426f626a6563742532304f626a656374253544266e616d653d696d6167652e706e67266f726967696e4865696768743d333638266f726967696e57696474683d31343936266f726967696e616c547970653d62696e61727926726174696f3d3126726f746174696f6e3d302673686f775469746c653d66616c73652673697a653d3438333136267374617475733d646f6e65267374796c653d6e6f6e65267461736b49643d7531373234333566332d323539372d346331302d383561372d3834363135663463656338267469746c653d2677696474683d373438)

需要注意的是，凡是补位产生的 `0`，需要用 `=` 来表示。所以最后的两位都是 `=`

最后 `abcd` 转换为 Base64 编码后为 `YWJjZA==`，整体原理还是比较简单的，不涉及到高深的算法。

## Base64 周边

1. 由于 `Base64` 转码后会包含 `+/=`字符，在 URL 不能正常传输。所以有一种 URL 友好型的 Base64 编码，它存在使用 `_-`来代替 `+/`，并且不在末尾追加 `=`
2. Base32、Base16 的原理和 Base64 基本一致
3. Base64 并不适合加密，因为解密太简单了
4. 汉字通过 `gb2312`、`utf-8`、`gbk`编码后，即可转成二进制处理。这里借用网上的一个图片说明：
   [![image.png](https://camo.githubusercontent.com/8706cc291fa1c110c390a1ce0ba88c233c791bd920996176277f0087f96bf491/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323032322f706e672f3138393335302f313635343432303536353337372d36333930366433632d633138662d346134342d613938302d3535663237636661633862612e706e6723636c69656e7449643d7538313135653762332d323864392d342663726f703d302663726f703d302663726f703d312663726f703d312666726f6d3d7061737465266865696768743d3232392669643d753934396132336333266d617267696e3d2535426f626a6563742532304f626a656374253544266e616d653d696d6167652e706e67266f726967696e4865696768743d313639266f726967696e57696474683d343832266f726967696e616c547970653d62696e61727926726174696f3d3126726f746174696f6e3d302673686f775469746c653d66616c73652673697a653d313030393935267374617475733d646f6e65267374796c653d6e6f6e65267461736b49643d7530366331646231632d356438662d346538612d396565332d6535316331663133663739267469746c653d2677696474683d363532)](https://camo.githubusercontent.com/8706cc291fa1c110c390a1ce0ba88c233c791bd920996176277f0087f96bf491/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323032322f706e672f3138393335302f313635343432303536353337372d36333930366433632d633138662d346134342d613938302d3535663237636661633862612e706e6723636c69656e7449643d7538313135653762332d323864392d342663726f703d302663726f703d302663726f703d312663726f703d312666726f6d3d7061737465266865696768743d3232392669643d753934396132336333266d617267696e3d2535426f626a6563742532304f626a656374253544266e616d653d696d6167652e706e67266f726967696e4865696768743d313639266f726967696e57696474683d343832266f726967696e616c547970653d62696e61727926726174696f3d3126726f746174696f6e3d302673686f775469746c653d66616c73652673697a653d313030393935267374617475733d646f6e65267374796c653d6e6f6e65267461736b49643d7530366331646231632d356438662d346538612d396565332d6535316331663133663739267469746c653d2677696474683d363532)

## Base58 与 Base58Check

Base58 是比特币在生成钱包地址时使用的一种编码形式。它和 Base64 的主要区别是去掉了肉眼容易看错的字符 0（零）、O（大写字母 O）、I（大写字母 i）、l（小写字母 L）和几个影响双击选择的字符：/ 和 +
这种编码的目的比较简单，就是防止在转账时，看错账号，转错账。
Base58 的原理更简单一些，只涉及到进制的转换，大致步骤如下：

1. 将字符转成 ASCII 码
2. 将 ASCII 码转换成 58 进制
3. 通过彩虹表映射即可

比如 `abcd`转换：

1. 转成 ASCII 码 97-98-99-100
2. 转换成 58 进制 3-28-21-49-5-22
3. 通过如下彩虹表映射为 3VNr6P

[![image.png](https://camo.githubusercontent.com/44fed7608aa7b5edf27c2c6155f1c193e096fde5caeabb71af6910b5305171fd/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323032322f706e672f3138393335302f313635343432303536353038352d31643735336165382d396239332d343437632d616364332d3165316132656533393463652e706e6723636c69656e7449643d7538313135653762332d323864392d342663726f703d302663726f703d302663726f703d312663726f703d312666726f6d3d7061737465266865696768743d3632312669643d756337366638353730266d617267696e3d2535426f626a6563742532304f626a656374253544266e616d653d696d6167652e706e67266f726967696e4865696768743d343436266f726967696e57696474683d343839266f726967696e616c547970653d62696e61727926726174696f3d3126726f746174696f6e3d302673686f775469746c653d66616c73652673697a653d3233383231267374617475733d646f6e65267374796c653d6e6f6e65267461736b49643d7561646364323432342d636630372d343635322d623161312d6438386664393337373737267469746c653d2677696474683d3638302e35)](https://camo.githubusercontent.com/44fed7608aa7b5edf27c2c6155f1c193e096fde5caeabb71af6910b5305171fd/68747470733a2f2f63646e2e6e6c61726b2e636f6d2f79757175652f302f323032322f706e672f3138393335302f313635343432303536353038352d31643735336165382d396239332d343437632d616364332d3165316132656533393463652e706e6723636c69656e7449643d7538313135653762332d323864392d342663726f703d302663726f703d302663726f703d312663726f703d312666726f6d3d7061737465266865696768743d3632312669643d756337366638353730266d617267696e3d2535426f626a6563742532304f626a656374253544266e616d653d696d6167652e706e67266f726967696e4865696768743d343436266f726967696e57696474683d343839266f726967696e616c547970653d62696e61727926726174696f3d3126726f746174696f6e3d302673686f775469746c653d66616c73652673697a653d3233383231267374617475733d646f6e65267374796c653d6e6f6e65267461736b49643d7561646364323432342d636630372d343635322d623161312d6438386664393337373737267469746c653d2677696474683d3638302e35)

Base58Check 编码，顾名思义是可以对 Base58 编码进行检查。
比如我在传输 `qH912cvztx`编码时，如果网络异常等各种原因，导致数据错乱或丢失，接收方要能够识别出来数据有问题。
Base58Check 编码基本原理如下：

1. 在 data 前面添加一个版本标识 prefix，用来识别编码的数据类型，比如比特币地址的前缀是 0（十六进制是 0x00）
2. 通过 hash 算法计算 `prefix + data`的 hash 值：`SHA256(prefix + data)`
3. 将生成的 hash 值截断为前四位，拼接到后面 `prefix + data + 4 位 hash`
4. 将上一步生成的结果进行 Base58 编码计算，得到最终结果